<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nebulyn Grid Engine - Enhanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #ffffff;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            display: flex;
            gap: 25px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .controls {
            width: 350px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            height: fit-content;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .controls h2, .controls h3 {
            margin-bottom: 15px;
            color: #4caf50;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .coordinate-display {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        
        .control-section {
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .control-section button {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #4caf50, #45a049);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        
        .control-section button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }
        
        .control-section button:active {
            transform: translateY(0);
        }
        
        .grid-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        #data-output {
            width: 100%;
            height: 200px;
            background: rgba(0, 0, 0, 0.3);
            color: #4caf50;
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
        }
        
        .port-builder {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .arrow-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin: 10px 0;
        }
        
        .arrow-btn {
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        
        .arrow-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .arrow-btn.active {
            background: #4caf50;
            border-color: #45a049;
        }
        
        .color-palette {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
            margin: 10px 0;
        }
        
        .color-btn {
            width: 30px;
            height: 30px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .color-btn:hover {
            transform: scale(1.1);
            border-color: white;
        }
        
        .color-btn.selected {
            border-color: #ffeb3b;
            border-width: 3px;
            transform: scale(1.1);
        }
        
        select, input {
            width: 100%;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: white;
            margin-bottom: 10px;
        }
        
        select option {
            background: #2a2a2a;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="controls">
            <h2>üåå Nebulyn Grid Engine</h2>
            
            <div class="coordinate-display">
                <span>üìç Coordinates: </span>
                <span id="coordinates">1,1</span>
            </div>
            
            <div class="control-section">
                <h3>üîß Port Builder</h3>
                <div class="port-builder">
                    <label>Block Type:</label>
                    <select id="block-select">
                        <option value="stone">Stone</option>
                        <option value="dirt">Dirt</option>
                        <option value="cobblestone">Cobblestone</option>
                        <option value="wood">Wood Planks</option>
                        <option value="iron_block">Iron Block</option>
                        <option value="gold_block">Gold Block</option>
                        <option value="diamond_block">Diamond Block</option>
                        <option value="emerald_block">Emerald Block</option>
                        <option value="redstone_block">Redstone Block</option>
                        <option value="lapis_block">Lapis Block</option>
                    </select>
                    
                    <label>Color:</label>
                    <div class="color-palette" id="color-palette"></div>
                    
                    <label>Input Arrows:</label>
                    <div class="arrow-grid" id="input-arrows"></div>
                    
                    <label>Output Arrows:</label>
                    <div class="arrow-grid" id="output-arrows"></div>
                    
                    <button onclick="addPortToSelected()">‚ûï Add Port to Selected Cell</button>
                </div>
            </div>
            
            <div class="control-section">
                <h3>üéÆ Port Management</h3>
                <button onclick="addRandomPort()">üé≤ Add Random Port</button>
                <button onclick="removeSelectedPort()">üóëÔ∏è Remove Selected Port</button>
                <button onclick="clearAllPorts()">üßπ Clear All Ports</button>
                <button onclick="duplicatePort()">üìã Duplicate Selected Port</button>
            </div>
            
            <div class="control-section">
                <h3>üíæ Data Management</h3>
                <button onclick="saveToFile()">üì§ Export to JSON</button>
                <button onclick="loadFromFile()">üì• Import from JSON</button>
                <button onclick="saveToLocal()">üíø Save to Browser</button>
                <button onclick="loadFromLocal()">üìÄ Load from Browser</button>
            </div>
            
            <div class="control-section">
                <h3>üé® Color Grids</h3>
                <button onclick="generateColorGrids()">üåà Generate Color Grids</button>
                <button onclick="setTexturePath()">üñºÔ∏è Set Texture Folder</button>
                <textarea id="data-output" placeholder="Grid data and logs will appear here..." readonly></textarea>
            </div>
        </div>
        
        <div class="grid-container">
            <div id="main-grid"></div>
        </div>
    </div>

    <!-- Include the Nebulyn scripts -->
    <script src="nebulyn-grid-engine.js"></script>
    <script src="nebulyn-data-manager.js"></script>
    
    <script>
        // Initialize the grid engine and data manager
        let grid, dataManager;
        let selectedColor = 'red';
        let selectedInputArrows = [];
        let selectedOutputArrows = [];
        
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize grid with coordinate tracking
            grid = new NebulynGridEngine('main-grid', {
                cellSize: 45,
                textureBasePath: './textures/',
                onCoordinateChange: (x, y) => {
                    document.getElementById('coordinates').textContent = `${x},${y}`;
                },
                onPortChange: (action, coord, portData) => {
                    const inputs = portData.inputArrows.length;
                    const outputs = portData.outputArrows.length;
                    log(`üîå Port ${action} at ${coord}: ${portData.color} ${portData.block} (${inputs}‚Üí${outputs})`);
                }
            });
            
            // Initialize data manager
            dataManager = new NebulynDataManager();
            
            // Setup UI
            setupColorPalette();
            setupArrowGrids();
            
            // Add some example ports
            grid.addPort(5, 10, {
                inputArrows: ['top', 'left'],
                outputArrows: ['right'],
                block: 'stone',
                color: 'red'
            });
            
            grid.addPort(8, 12, {
                inputArrows: ['bottom'],
                outputArrows: ['top', 'right', 'top-right'],
                block: 'iron_block',
                color: 'blue'
            });
            
            grid.addPort(3, 7, {
                inputArrows: ['left', 'bottom-left'],
                outputArrows: ['right', 'top-right'],
                block: 'gold_block',
                color: 'yellow'
            });
            
            log('üåå Nebulyn Grid Engine Enhanced initialized!');
            log('‚ú® Features: Multiple I/O, Textures, Enhanced UI');
        });
        
        function setupColorPalette() {
            const palette = document.getElementById('color-palette');
            const colors = grid.getMinecraftColors();
            
            Object.entries(colors).forEach(([name, hex]) => {
                const btn = document.createElement('div');
                btn.className = 'color-btn';
                btn.style.backgroundColor = hex;
                btn.title = name;
                btn.onclick = () => selectColor(name, btn);
                if (name === 'red') btn.classList.add('selected');
                palette.appendChild(btn);
            });
        }
        
        function setupArrowGrids() {
            const positions = ['top-left', 'top', 'top-right', 'left', '', 'right', 'bottom-left', 'bottom', 'bottom-right'];
            const inputGrid = document.getElementById('input-arrows');
            const outputGrid = document.getElementById('output-arrows');
            
            positions.forEach(pos => {
                // Input arrows
                const inputBtn = document.createElement('div');
                inputBtn.className = 'arrow-btn';
                inputBtn.textContent = pos ? '‚Üí' : '';
                inputBtn.title = pos || '';
                if (pos) {
                    inputBtn.onclick = () => toggleArrow('input', pos, inputBtn);
                }
                inputGrid.appendChild(inputBtn);
                
                // Output arrows
                const outputBtn = document.createElement('div');
                outputBtn.className = 'arrow-btn';
                outputBtn.textContent = pos ? '‚Üê' : '';
                outputBtn.title = pos || '';
                if (pos) {
                    outputBtn.onclick = () => toggleArrow('output', pos, outputBtn);
                }
                outputGrid.appendChild(outputBtn);
            });
        }
        
        function selectColor(colorName, btn) {
            document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedColor = colorName;
        }
        
        function toggleArrow(type, position, btn) {
            const array = type === 'input' ? selectedInputArrows : selectedOutputArrows;
            const index = array.indexOf(position);
            
            if (index > -1) {
                array.splice(index, 1);
                btn.classList.remove('active');
            } else {
                array.push(position);
                btn.classList.add('active');
            }
        }
        
        // Helper function to log messages
        function log(message) {
            const output = document.getElementById('data-output');
            const timestamp = new Date().toLocaleTimeString();
            output.value += `[${timestamp}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }
        
        // Enhanced control functions
        function addPortToSelected() {
            const selected = grid.getSelectedCell();
            if (!selected) {
                log('‚ùå No cell selected');
                return;
            }
            
            const [x, y] = selected.split(',').map(Number);
            const blockType = document.getElementById('block-select').value;
            
            grid.addPort(x, y, {
                inputArrows: [...selectedInputArrows],
                outputArrows: [...selectedOutputArrows],
                block: blockType,
                color: selectedColor
            });
            
            log(`‚úÖ Added port at ${selected}: ${selectedInputArrows.length} inputs, ${selectedOutputArrows.length} outputs`);
        }
        
        function addRandomPort() {
            const colors = Object.keys(grid.getMinecraftColors());
            const blocks = ['stone', 'dirt', 'iron_block', 'gold_block', 'diamond_block'];
            const positions = grid.getArrowPositions();
            
            const x = Math.floor(Math.random() * 16) + 1;
            const y = Math.floor(Math.random() * 16) + 1;
            
            // Random number of inputs/outputs (1-3 each)
            const numInputs = Math.floor(Math.random() * 3) + 1;
            const numOutputs = Math.floor(Math.random() * 3) + 1;
            
            const inputArrows = [];
            const outputArrows = [];
            
            // Select random positions
            for (let i = 0; i < numInputs; i++) {
                const pos = positions[Math.floor(Math.random() * positions.length)];
                if (!inputArrows.includes(pos)) inputArrows.push(pos);
            }
            
            for (let i = 0; i < numOutputs; i++) {
                const pos = positions[Math.floor(Math.random() * positions.length)];
                if (!outputArrows.includes(pos)) outputArrows.push(pos);
            }
            
            grid.addPort(x, y, {
                inputArrows,
                outputArrows,
                block: blocks[Math.floor(Math.random() * blocks.length)],
                color: colors[Math.floor(Math.random() * colors.length)]
            });
            
            log(`üé≤ Random port added at ${x},${y}`);
        }
        
        function removeSelectedPort() {
            const selected = grid.getSelectedCell();
            if (selected) {
                const [x, y] = selected.split(',').map(Number);
                if (grid.removePort(x, y)) {
                    log(`üóëÔ∏è Removed port at ${selected}`);
                } else {
                    log(`‚ùå No port found at ${selected}`);
                }
            } else {
                log('‚ùå No cell selected');
            }
        }
        
        function duplicatePort() {
            const selected = grid.getSelectedCell();
            if (!selected) {
                log('‚ùå No cell selected');
                return;
            }
            
            const [x, y] = selected.split(',').map(Number);
            const port = grid.getPortAt(x, y);
            if (!port) {
                log('‚ùå No port at selected cell');
                return;
            }
            
            // Find empty adjacent cell
            const adjacent = [
                [x+1, y], [x-1, y], [x, y+1], [x, y-1],
                [x+1, y+1], [x-1, y-1], [x+1, y-1], [x-1, y+1]
            ];
            
            for (const [newX, newY] of adjacent) {
                if (newX >= 1 && newX <= 16 && newY >= 1 && newY <= 16 && !grid.getPortAt(newX, newY)) {
                    grid.addPort(newX, newY, {
                        inputArrows: [...port.inputArrows],
                        outputArrows: [...port.outputArrows],
                        block: port.block,
                        color: port.color
                    });
                    log(`üìã Duplicated port to ${newX},${newY}`);
                    return;
                }
            }
            
            log('‚ùå No empty adjacent cells found');
        }
        
        function clearAllPorts() {
            grid.clearAllPorts();
            log('üßπ All ports cleared');
        }
        
        function saveToFile() {
            const data = grid.getData();
            dataManager.exportToFile(data, 'nebulyn-enhanced-grid.json');
            log('üì§ Grid exported to file');
        }
        
        function loadFromFile() {
            dataManager.createFileInput((data) => {
                grid.setData(data);
                log(`üì• Grid loaded: ${data.ports.length} ports`);
            });
        }
        
        function saveToLocal() {
            const gridName = prompt('Enter grid name:') || 'enhanced-grid';
            const success = dataManager.saveToLocalStorage(gridName, grid.getData());
            log(success ? `üíø Saved as "${gridName}"` : '‚ùå Save failed');
        }
        
        function loadFromLocal() {
            const savedGrids = dataManager.listSavedGrids();
            if (savedGrids.length === 0) {
                log('‚ùå No saved grids found');
                return;
            }
            
            const gridList = savedGrids.map(g => `${g.name} (${g.portCount} ports)`).join('\n');
            const gridName = prompt(`Select grid to load:\n${gridList}\n\nEnter grid name:`);
            
            if (gridName) {
                const data = dataManager.loadFromLocalStorage(gridName);
                if (data) {
                    grid.setData(data);
                    log(`üìÄ Loaded "${gridName}": ${data.ports.length} ports`);
                } else {
                    log('‚ùå Grid not found');
                }
            }
        }
        
        function generateColorGrids() {
            const mainData = grid.getData();
            const colorGrids = dataManager.generateColorGrids(mainData);
            
            // Export each color grid as separate JSON files
            Object.entries(colorGrids).forEach(([color, gridData]) => {
                dataManager.exportToFile(gridData, `nebulyn-${color}-enhanced.json`);
            });
            
            log(`üåà Generated ${Object.keys(colorGrids).length} color grids: ${Object.keys(colorGrids).join(', ')}`);
        }
        
        function setTexturePath() {
            const path = prompt('Enter texture folder path (e.g., ./textures/ or https://example.com/textures/):', grid.textureBasePath);
            if (path) {
                grid.setTextureBasePath(path);
                log(`üñºÔ∏è Texture path set to: ${path}`);
            }
        }
    </script>
</body>
</html>
