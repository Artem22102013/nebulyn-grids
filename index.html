<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nebulyn Grid Engine</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: 'Courier New', monospace;
            background-color: #2a2a2a;
            color: #ffffff;
            padding: 20px;
            margin: 0;
        }
        .container {
            display: flex;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .controls {
            width: 300px;
            background-color: #3a3a3a;
            padding: 20px;
            border-radius: 8px;
            height: fit-content;
        }
        .controls h2, .controls h3 {
            margin-bottom: 15px;
            color: #4caf50;
        }
        .coordinate-display {
            background-color: #4a4a4a;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: bold;
        }
        .control-section {
            margin-bottom: 20px;
        }
        .control-section button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .control-section button:hover {
            background-color: #45a049;
        }
        .grid-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        #data-output {
            width: 100%;
            height: 150px;
            background-color: #4a4a4a;
            color: white;
            border: 1px solid #666;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            resize: vertical;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="controls">
            <h2>Nebulyn Grid Engine</h2>
            
            <div class="coordinate-display">
                <span>Coordinates: </span>
                <span id="coordinates">1,1</span>
            </div>
            
            <div class="control-section">
                <h3>Port Management</h3>
                <button onclick="addExamplePort()">Add Example Port</button>
                <button onclick="removeSelectedPort()">Remove Selected Port</button>
                <button onclick="clearAllPorts()">Clear All Ports</button>
            </div>
            
            <div class="control-section">
                <h3>Data Management</h3>
                <button onclick="saveToFile()">Export to JSON</button>
                <button onclick="loadFromFile()">Import from JSON</button>
                <button onclick="saveToLocal()">Save to Browser</button>
                <button onclick="loadFromLocal()">Load from Browser</button>
            </div>
            
            <div class="control-section">
                <h3>Color Grids</h3>
                <button onclick="generateColorGrids()">Generate Color Grids</button>
                <textarea id="data-output" placeholder="Grid data and logs will appear here..." readonly></textarea>
            </div>
        </div>
        
        <div class="grid-container">
            <div id="main-grid"></div>
        </div>
    </div>

    <!-- Include the Nebulyn scripts -->
    <script src="nebulyn-grid-engine.js"></script>
    <script src="nebulyn-data-manager.js"></script>
    
    <script>
        // Initialize the grid engine and data manager
        let grid, dataManager;
        
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize grid with coordinate tracking
            grid = new NebulynGridEngine('main-grid', {
                onCoordinateChange: (x, y) => {
                    document.getElementById('coordinates').textContent = `${x},${y}`;
                },
                onPortChange: (action, coord, portData) => {
                    log(`Port ${action} at ${coord}: ${portData.color} ${portData.block}`);
                }
            });
            
            // Initialize data manager
            dataManager = new NebulynDataManager();
            
            // Add some example ports
            grid.addPort(5, 10, {
                inputArrow: true,
                outputArrow: false,
                block: 'stone',
                color: 'red'
            });
            
            grid.addPort(8, 12, {
                inputArrow: false,
                outputArrow: true,
                block: 'iron',
                color: 'blue'
            });
            
            log('Nebulyn Grid Engine initialized!');
        });
        
        // Helper function to log messages
        function log(message) {
            const output = document.getElementById('data-output');
            output.value += new Date().toLocaleTimeString() + ': ' + message + '\n';
            output.scrollTop = output.scrollHeight;
        }
        
        // Control functions
        function addExamplePort() {
            const colors = ['red', 'blue', 'green', 'yellow', 'purple', 'orange'];
            const blocks = ['stone', 'iron', 'gold', 'diamond'];
            const x = Math.floor(Math.random() * 16) + 1;
            const y = Math.floor(Math.random() * 16) + 1;
            
            grid.addPort(x, y, {
                inputArrow: Math.random() > 0.5,
                outputArrow: Math.random() > 0.5,
                block: blocks[Math.floor(Math.random() * blocks.length)],
                color: colors[Math.floor(Math.random() * colors.length)]
            });
        }
        
        function removeSelectedPort() {
            const selected = grid.getSelectedCell();
            if (selected) {
                const [x, y] = selected.split(',').map(Number);
                if (grid.removePort(x, y)) {
                    log(`Removed port at ${selected}`);
                } else {
                    log(`No port found at ${selected}`);
                }
            } else {
                log('No cell selected');
            }
        }
        
        function clearAllPorts() {
            grid.clearAllPorts();
            log('All ports cleared');
        }
        
        function saveToFile() {
            const data = grid.getData();
            dataManager.exportToFile(data, 'my-nebulyn-grid.json');
            log('Grid exported to file');
        }
        
        function loadFromFile() {
            dataManager.createFileInput((data) => {
                grid.setData(data);
                log(`Grid loaded: ${data.ports.length} ports`);
            });
        }
        
        function saveToLocal() {
            const gridName = prompt('Enter grid name:') || 'default-grid';
            const success = dataManager.saveToLocalStorage(gridName, grid.getData());
            log(success ? `Saved as "${gridName}"` : 'Save failed');
        }
        
        function loadFromLocal() {
            const savedGrids = dataManager.listSavedGrids();
            if (savedGrids.length === 0) {
                log('No saved grids found');
                return;
            }
            
            const gridList = savedGrids.map(g => `${g.name} (${g.portCount} ports)`).join('\n');
            const gridName = prompt(`Select grid to load:\n${gridList}\n\nEnter grid name:`);
            
            if (gridName) {
                const data = dataManager.loadFromLocalStorage(gridName);
                if (data) {
                    grid.setData(data);
                    log(`Loaded "${gridName}": ${data.ports.length} ports`);
                } else {
                    log('Grid not found');
                }
            }
        }
        
        function generateColorGrids() {
            const mainData = grid.getData();
            const colorGrids = dataManager.generateColorGrids(mainData);
            
            // Export each color grid as separate JSON files
            Object.entries(colorGrids).forEach(([color, gridData]) => {
                dataManager.exportToFile(gridData, `nebulyn-${color}-grid.json`);
            });
            
            log(`Generated ${Object.keys(colorGrids).length} color grids: ${Object.keys(colorGrids).join(', ')}`);
        }
    </script>
</body>
</html>
